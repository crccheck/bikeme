{% extends "base.html" %}

{% block extra_style %}{{ block.super }}
  <style>
    .active { color: blue; }
    .fa { width: 1.5em; }
    #map {
      height: 600px;
    }
    .filled-marker {

    }
  </style>
{% endblock %}


{% block main %}
  <h1>{{ object }}</h1>
  {# TODO #}
  {# Last Updated: {{ object.updated_at }} #}
  <div id="map"></div>
{% endblock %}


{% block extra_script %}{{ block.super }}
  <script>
    var stations = {{ station_json|safe }};
  </script>
  <script>
    var getIcon = function (stand) {
      // http://leafletjs.com/reference.html#divicon
      var filled = Math.round(stand.bikes / (stand.bikes + stand.docks) * 10);
      return L.divIcon({
        className: 'filled-marker',
        html: '<div class="filled-' + filled + '">X</div>',
        iconAnchornSize: null,
        iconAnchor: null
      });
    };

    // create a map in the "map" div, set the view to a given place and zoom
    var map = L.map('map', {
          scrollWheelZoom: false
        }),
        bounds = [];

    $.each(stations, function (idx, stand) {
      bounds.push([stand.latitude, stand.longitude]);
      L.marker([stand.latitude, stand.longitude], {
        icon: getIcon(stand),
        title: stand.name + '\nBikes:' + stand.bikes + '\nDocks:' + stand.docks
      }).addTo(map);
    });

    // add an OpenStreetMap tile layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    map.fitBounds(bounds);
  </script>
{% endblock %}
